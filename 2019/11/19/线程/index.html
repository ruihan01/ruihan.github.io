<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>线程 ~ Hexo</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Hexo</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">Archives</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">Categories</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">Tags</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">About</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>


</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/people3.jpg')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  Tuesday, November 19th 2019, 9:45 pm
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    2.3k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      11 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h5 id="1-区分："><a href="#1-区分：" class="headerlink" title="1. 区分："></a>1. 区分：</h5><ul>
<li>程序：可以理解为一组静态的代码</li>
<li>进程：正在进行的程序（静态的代码运行起来）</li>
<li>线程：进程中的一个小单元 ，操作系统级别 CPU</li>
</ul>
<h5 id="2-类别："><a href="#2-类别：" class="headerlink" title="2. 类别："></a>2. 类别：</h5><ul>
<li>主线程 系统线程</li>
<li>用户线程 main</li>
<li>守护线程 GC</li>
</ul>
<h5 id="3-生命周期："><a href="#3-生命周期：" class="headerlink" title="3. 生命周期："></a>3. 生命周期：</h5><p>创建线程—就绪状态—执行状态—等待/挂起—异常/消亡<br><img src="https://pic.superbed.cn/item/5dd3cf198e0e2e3ee9287846.png?ynotemdtimestamp=1573975351449" srcset="undefined" alt="img"></p>
<h5 id="4-实现线程的过程："><a href="#4-实现线程的过程：" class="headerlink" title="4. 实现线程的过程："></a>4. 实现线程的过程：</h5><ul>
<li>自己描述一个类</li>
<li>继承一个父类Thread</li>
<li>重写run()方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package testthread;</span><br><span class="line"></span><br><span class="line">public class Runningman  extends Thread&#123;</span><br><span class="line">    private String name;</span><br><span class="line">    public Runningman()&#123;&#125;</span><br><span class="line">    public Runningman(String name)&#123;</span><br><span class="line">        this.name=name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        for (int i=1;i&lt;=100;i++)&#123;</span><br><span class="line">            System.out.println(this.name+&quot;跑到第&quot;+i+&quot;米&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>new一个线程对象，调用start()方法，让线程进入就绪状态。 （可以直接调用）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import testthread.Runningman;</span><br><span class="line"></span><br><span class="line">public class testMain &#123;</span><br><span class="line">    public static void main(String[]args)&#123;</span><br><span class="line">        Runningman r1=new Runningman(&quot;苏炳添&quot;);</span><br><span class="line">        Runningman r2=new Runningman(&quot;伏尔特&quot;);</span><br><span class="line">        Runningman r3 =new Runningman(&quot;加特林&quot;);</span><br><span class="line"></span><br><span class="line">        r1.start();</span><br><span class="line">        r2.start();</span><br><span class="line">        r3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-实现线程的过程："><a href="#5-实现线程的过程：" class="headerlink" title="5. 实现线程的过程："></a>5. 实现线程的过程：</h5><ul>
<li>自己描述一个类</li>
<li>实现一个父接口Runnable</li>
<li>重写run方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package testthread;</span><br><span class="line"></span><br><span class="line">public class Runningman  implements Runnable&#123;</span><br><span class="line">    private String name;</span><br><span class="line">    public Runningman()&#123;&#125;</span><br><span class="line">    public Runningman(String name)&#123;</span><br><span class="line">        this.name=name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        for (int i=1;i&lt;=100;i++)&#123;</span><br><span class="line">            System.out.println(this.name+&quot;跑到第&quot;+i+&quot;米&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>new一个线程对象，调用start()方法，让线程进入就绪状态。 （需要先创建一个Thread对象，然后再调用）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class testMain &#123;</span><br><span class="line">    public static void main(String[]args)&#123;</span><br><span class="line">        Runningman r1=new Runningman(&quot;苏炳添&quot;);</span><br><span class="line">        Runningman r2=new Runningman(&quot;伏尔特&quot;);</span><br><span class="line">        Runningman r3 =new Runningman(&quot;加特林&quot;);</span><br><span class="line">        Thread t1=new Thread(r1);</span><br><span class="line">        Thread t2=new Thread(r2);</span><br><span class="line">        Thread t3=new Thread(r3);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6-join方法"><a href="#6-join方法" class="headerlink" title="6. join方法"></a>6. join方法</h5><h6 id="一、过程叙述：1线程执行的时候，2线程才开始创建，然后2线程执行5000毫秒结束，继续执行1线程直到1线程结束。"><a href="#一、过程叙述：1线程执行的时候，2线程才开始创建，然后2线程执行5000毫秒结束，继续执行1线程直到1线程结束。" class="headerlink" title="一、过程叙述：1线程执行的时候，2线程才开始创建，然后2线程执行5000毫秒结束，继续执行1线程直到1线程结束。"></a>一、过程叙述：1线程执行的时候，2线程才开始创建，然后2线程执行5000毫秒结束，继续执行1线程直到1线程结束。</h6><p>1线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package testjoin;</span><br><span class="line"></span><br><span class="line">public class ThreadOne extends Thread&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;thread one start&quot;);</span><br><span class="line">        ThreadTwo two=new ThreadTwo();</span><br><span class="line">        two.start();//线程2一定在线程1后面执行</span><br><span class="line">        try &#123;</span><br><span class="line">            two.join();//线程2加入到线程1中</span><br><span class="line">            //two.join()调用方法的</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;thread one end&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>解释two执行过程中one没执行—&gt;源码解释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (millis == 0) &#123;//join方法参数为0</span><br><span class="line">            while (isAlive()) &#123;</span><br><span class="line">            //如果线程活着，相当于this.isAlive,this是指当前调方法的two，即相当于two.isAlive。</span><br><span class="line">                wait(0);</span><br><span class="line">                //相当于this.wait,this是指当前调方法的two，即相当于two.wait,但并不是two等着，而是访问two的线程进入等待状态，即one进入等待状态。</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>2线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package testjoin;</span><br><span class="line"></span><br><span class="line">public class ThreadTwo extends Thread &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;thread two start&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(5000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;thread two end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package testjoin;</span><br><span class="line"></span><br><span class="line">public class TestMain &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        ThreadOne one=new ThreadOne();</span><br><span class="line">        one.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">thread one start  </span><br><span class="line">thread two start  </span><br><span class="line">thread two end  </span><br><span class="line">thread one end</span><br></pre></td></tr></table></figure>

<h6 id="二、如果2线程加入1线程的执行时间要短，2线程执行时间要长，1线程则不再等2线程执行完。如下。"><a href="#二、如果2线程加入1线程的执行时间要短，2线程执行时间要长，1线程则不再等2线程执行完。如下。" class="headerlink" title="二、如果2线程加入1线程的执行时间要短，2线程执行时间要长，1线程则不再等2线程执行完。如下。"></a>二、如果2线程加入1线程的执行时间要短，2线程执行时间要长，1线程则不再等2线程执行完。如下。</h6><p>1线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package testjoin;</span><br><span class="line"></span><br><span class="line">public class ThreadOne extends Thread&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;thread one start&quot;);</span><br><span class="line">        ThreadTwo two=new ThreadTwo();</span><br><span class="line">        two.start();//线程2一定在线程1后面执行</span><br><span class="line">        try &#123;</span><br><span class="line">            two.join(2000);//线程2加入到线程1中，有一个方法重载，加入参数2000毫秒，而实际2线程需要5000毫秒执行完毕。</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;thread one end&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2线程和主函数不变，运行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">thread one start  </span><br><span class="line">thread two start  </span><br><span class="line">thread one end  </span><br><span class="line">thread two end</span><br></pre></td></tr></table></figure>

<h6 id="三、源码中的锁："><a href="#三、源码中的锁：" class="headerlink" title="三、源码中的锁："></a>三、源码中的锁：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public final synchronized void join(final long millis)</span><br><span class="line">//synchronized 关键字，One把two锁住了</span><br></pre></td></tr></table></figure>

<p>过程叙述：<br>1线程启动，然后2线程启动，然后3线程启动，2线程被3线程锁定。<br>2线程执行2000毫秒后，1线程想要将2线程剔除，但此时2线程被3线程锁定，所以只能在3线程锁定2线程10000毫秒后即2线程被释放后剔除2线程，其自己继续执行直到结束。<br>2线程执行完5000毫秒后即结束。<br>2线程被释放后，3线程也结束运行。</p>
<p>1线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package testjoin;</span><br><span class="line"></span><br><span class="line">public class ThreadOne extends Thread&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;thread one start&quot;);</span><br><span class="line">        ThreadTwo two=new ThreadTwo();</span><br><span class="line">        two.start();//线程2一定在线程1后面执行</span><br><span class="line">        try &#123;</span><br><span class="line">            two.join(2000);//线程2加入到线程1中</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;thread one end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package testjoin;</span><br><span class="line"></span><br><span class="line">public class ThreadTwo extends Thread &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;thread two start&quot;);</span><br><span class="line">        ThreadThree three=new ThreadThree(this);</span><br><span class="line">        three.start();</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(5000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;thread two end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package testjoin;</span><br><span class="line"></span><br><span class="line">public class ThreadThree extends Thread&#123;</span><br><span class="line">    private ThreadTwo two=new ThreadTwo();</span><br><span class="line">    public ThreadThree(ThreadTwo two)&#123;</span><br><span class="line">        this.two=two;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        //在two执行的过程中，one等待的过程中，three将two对象锁定</span><br><span class="line">        System.out.println(&quot;thread three start&quot;);</span><br><span class="line"></span><br><span class="line">        synchronized (two)&#123;</span><br><span class="line">            System.out.println(&quot;two is locked&quot;);</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(10000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;two is free&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;thread three end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主函数不变，运行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">thread one start</span><br><span class="line">thread two start</span><br><span class="line">thread three start</span><br><span class="line">two is locked</span><br><span class="line">thread two end</span><br><span class="line">two is free</span><br><span class="line">thread three end</span><br><span class="line">thread one end</span><br></pre></td></tr></table></figure>

<h5 id="7-死锁的效果"><a href="#7-死锁的效果" class="headerlink" title="7. 死锁的效果"></a>7. 死锁的效果</h5><p>哲学家就餐问题：四个哲学家，四支筷子，每个人先拿左手边的筷子，再拿右手边的筷子，拿到一双就可以吃饭了。</p>
<p>筷子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package philosopher;</span><br><span class="line"></span><br><span class="line">public class Chopstick &#123;</span><br><span class="line">    private int num;</span><br><span class="line">    public Chopstick(int num)&#123;</span><br><span class="line">        this.num=num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getNum() &#123;</span><br><span class="line">        return num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>哲学家：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package philosopher;</span><br><span class="line"></span><br><span class="line">public class Philosopher extends Thread&#123;</span><br><span class="line">    private String pname;</span><br><span class="line">    private Chopstick left;</span><br><span class="line">    private Chopstick right;</span><br><span class="line">    public Philosopher(String pname,Chopstick left,Chopstick right)&#123;</span><br><span class="line">        this.pname=pname;</span><br><span class="line">        this.left=left;</span><br><span class="line">        this.right=right;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        synchronized (left)&#123;</span><br><span class="line">            System.out.println(this.pname+&quot;拿左手边的&quot;+left.getNum()+&quot;筷子&quot;);</span><br><span class="line">            synchronized (right)&#123;</span><br><span class="line">                System.out.println(this.pname+&quot;拿右手边的&quot;+right.getNum()+&quot;筷子&quot;);</span><br><span class="line">                System.out.println(this.pname+&quot;开始吃东西&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package philosopher;</span><br><span class="line"></span><br><span class="line">public class TeatMain &#123;</span><br><span class="line">    public static void main(String[]args)&#123;</span><br><span class="line">        Chopstick c1=new Chopstick(1);</span><br><span class="line">        Chopstick c2=new Chopstick(2);</span><br><span class="line">        Chopstick c3=new Chopstick(3);</span><br><span class="line">        Chopstick c4=new Chopstick(4);</span><br><span class="line"></span><br><span class="line">        Philosopher p1=new Philosopher(&quot;a&quot;,c2,c1);</span><br><span class="line">        Philosopher p2=new Philosopher(&quot;b&quot;,c3,c2);</span><br><span class="line">        Philosopher p3=new Philosopher(&quot;c&quot;,c4,c3);</span><br><span class="line">        Philosopher p4=new Philosopher(&quot;d&quot;,c1,c4);</span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">        p4.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="8-解决死锁问题："><a href="#8-解决死锁问题：" class="headerlink" title="8. 解决死锁问题："></a>8. 解决死锁问题：</h5><ul>
<li>产生时间差</li>
</ul>
<p>设定每个哲学家开始吃饭时间不同：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package philosopher;</span><br><span class="line"></span><br><span class="line">public class Philosopher extends Thread&#123;</span><br><span class="line">    private String pname;</span><br><span class="line">    private Chopstick left;</span><br><span class="line">    private Chopstick right;</span><br><span class="line">    private long time;</span><br><span class="line">    public Philosopher(String pname,Chopstick left,Chopstick right,long time)&#123;</span><br><span class="line">        this.pname=pname;</span><br><span class="line">        this.left=left;</span><br><span class="line">        this.right=right;</span><br><span class="line">        this.time=time;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(time);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        synchronized (left)&#123;</span><br><span class="line">            System.out.println(this.pname+&quot;拿左手边的&quot;+left.getNum()+&quot;筷子&quot;);</span><br><span class="line">            synchronized (right)&#123;</span><br><span class="line">                System.out.println(this.pname+&quot;拿右手边的&quot;+right.getNum()+&quot;筷子&quot;);</span><br><span class="line">                System.out.println(this.pname+&quot;开始吃东西&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package philosopher;</span><br><span class="line"></span><br><span class="line">public class TeatMain &#123;</span><br><span class="line">    public static void main(String[]args)&#123;</span><br><span class="line">        Chopstick c1=new Chopstick(1);</span><br><span class="line">        Chopstick c2=new Chopstick(2);</span><br><span class="line">        Chopstick c3=new Chopstick(3);</span><br><span class="line">        Chopstick c4=new Chopstick(4);</span><br><span class="line"></span><br><span class="line">        Philosopher p1=new Philosopher(&quot;a&quot;,c2,c1,0);</span><br><span class="line">        Philosopher p2=new Philosopher(&quot;b&quot;,c3,c2,3000);</span><br><span class="line">        Philosopher p3=new Philosopher(&quot;c&quot;,c4,c3,6000);</span><br><span class="line">        Philosopher p4=new Philosopher(&quot;d&quot;,c1,c4,9000);</span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">        p4.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a拿左手边的2筷子</span><br><span class="line">a拿右手边的1筷子</span><br><span class="line">a开始吃东西</span><br><span class="line">b拿左手边的3筷子</span><br><span class="line">b拿右手边的2筷子</span><br><span class="line">b开始吃东西</span><br><span class="line">c拿左手边的4筷子</span><br><span class="line">c拿右手边的3筷子</span><br><span class="line">c开始吃东西</span><br><span class="line">d拿左手边的1筷子</span><br><span class="line">d拿右手边的4筷子</span><br><span class="line">d开始吃东西</span><br></pre></td></tr></table></figure>

<p>但是发现这样运行有点慢，所以可以稍微对主函数加以改进：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Philosopher p1=new Philosopher(&quot;a&quot;,c2,c1,0);</span><br><span class="line">Philosopher p2=new Philosopher(&quot;b&quot;,c3,c2,3000);</span><br><span class="line">Philosopher p3=new Philosopher(&quot;c&quot;,c4,c3,0);</span><br><span class="line">Philosopher p4=new Philosopher(&quot;d&quot;,c1,c4,3000);</span><br></pre></td></tr></table></figure>

<ul>
<li>不产生对象共用问题</li>
</ul>
<h5 id="9-计时器-定时器—-gt-线程应用Timer"><a href="#9-计时器-定时器—-gt-线程应用Timer" class="headerlink" title="9. 计时器/定时器—&gt;线程应用Timer"></a>9. 计时器/定时器—&gt;线程应用Timer</h5><p>Timer所属于java.util包</p>
<p>设计一个程序 每隔一段时间给每一个人发送一些信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package testtimer;</span><br><span class="line"></span><br><span class="line">import java.text.ParseException;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.Timer;</span><br><span class="line">import java.util.TimerTask;</span><br><span class="line">import java.util.logging.SimpleFormatter;</span><br><span class="line"></span><br><span class="line">public class TestTimer &#123;</span><br><span class="line">    </span><br><span class="line">    //属性</span><br><span class="line">    private ArrayList&lt;String&gt; userbox=new ArrayList&lt;&gt;();</span><br><span class="line">    &#123;</span><br><span class="line">        userbox.add(&quot;a&quot;);</span><br><span class="line">        userbox.add(&quot;b&quot;);</span><br><span class="line">        userbox.add(&quot;c&quot;);</span><br><span class="line">        userbox.add(&quot;d&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    private int count=1;</span><br><span class="line">    //设计一个方法 每隔一段时间给每一个人发送一些数据</span><br><span class="line">    public void test() throws ParseException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;预备，准备开始&quot;);</span><br><span class="line">        Timer timer=new Timer();</span><br><span class="line">        SimpleDateFormat sdf=new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">        Date firsttime=sdf.parse(&quot;2019-11-19 21:28:00&quot;);</span><br><span class="line">        timer.schedule(new TimerTask()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                System.out.println(&quot;第&quot;+(count++)+&quot;次执行&quot;);</span><br><span class="line">                for(int i=0;i&lt;userbox.size();i++)&#123;</span><br><span class="line">                    System.out.println(&quot;给&quot;+userbox.get(i)+&quot;发送了一条消息&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(&quot;发送成功！！！&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,firsttime,3000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> testtimer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        TestTimer testTimer=<span class="keyword">new</span> TestTimer();</span><br><span class="line">        testTimer.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


            <hr>
          </div>
          <br>
          <div>
            <p>
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/JAVA">JAVA</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;TOC</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  




  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "线程&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>







</body>
</html>
